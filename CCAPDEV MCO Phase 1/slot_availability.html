<!DOCTYPE html>
<html>
	<head>
		<title>Slot Availability</title>

		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
		<script type="text/javascript" src="scripts/date-time-scripts.js"></script>
		<link rel="stylesheet" type="text/css" media="all" href="navbar.css">
		<link rel="stylesheet" type="text/css" href="slot_availability.css">
		<link rel="stylesheet" type="text/css" href="stylebase.css">

		<script type="text/javascript">

				var reservations = [
					{
						"name" : "John Doe",
						"link" : "user_profile.html",
						"lab" : 1,
						"seat": 24,
						"datetime" : "2023-06-25T17:30",
						"isAnonymous" : false
					}
				]

				var reservationIntervals = [
					"07:30AM - 08:00AM",
					"08:00AM - 08:30AM",
					"08:30AM - 09:00AM",
					"09:00AM - 09:30AM",
					"09:30AM - 10:00AM",
					"10:00AM - 10:30AM",
					"10:30PM - 11:00AM",
					"11:00AM - 11:30AM",
					"11:30AM - 12:00PM",
					"12:00PM - 12:30PM",
					"12:30PM - 01:00PM",
					"01:00PM - 01:30PM",
					"01:30PM - 02:00PM",
					"02:00PM - 02:30PM",
					"02:30PM - 03:00PM",
					"03:00PM - 03:30PM",
					"03:30PM - 04:00PM",
					"04:00PM - 04:30PM",
					"04:30PM - 05:00PM",
					"05:00PM - 05:30PM",
					"05:30PM - 06:00PM",
					"06:00PM - 06:30PM",
					"06:30PM - 07:00PM",
					"07:00PM - 07:30PM",
					"07:30PM - 08:00PM",
					"08:00PM - 08:30PM",
					"08:30PM - 09:00PM"
				]

				var times = [
					"07:30",
					"08:00",
					"08:30",
					"09:00",
					"09:30",
					"10:00",
					"10:30",
					"11:00",
					"11:30",
					"12:00",
					"12:30",
					"13:00",
					"13:30",
					"14:00",
					"14:30",
					"15:00",
					"15:30",
					"16:00",
					"16:30",
					"17:00",
					"17:30",
					"18:00",
					"18:30",
					"19:00",
					"19:30",
					"20:00",
					"20:30",
					"21:00"
            	]

			function createCalendar(labNum) {
				const table = document.createElement('table');
				table.style.border = '1px solid black';

				var tableHeader = document.createElement('thead');
				table.appendChild(tableHeader);

				for (var i = 0; i < 8; i++) {

					var tHeadCell = tableHeader.appendChild(document.createElement('th'));

					switch (i) {
						case 1:
							tHeadCell.appendChild(document.createTextNode(moment(dateOffset(new Date(), 0)).format('dddd')));
							tHeadCell.appendChild(document.createElement('br'));
							tHeadCell.appendChild(document.createTextNode(parseDateToWords(dateOffset(new Date(), 0))));
							break;
						case 2:
							tHeadCell.appendChild(document.createTextNode(moment(dateOffset(new Date(), 1)).format('dddd')));
							tHeadCell.appendChild(document.createElement('br'));
							tHeadCell.appendChild(document.createTextNode(parseDateToWords(dateOffset(new Date(), 1))));
							break;
						case 3:
							tHeadCell.appendChild(document.createTextNode(moment(dateOffset(new Date(), 2)).format('dddd')));
							tHeadCell.appendChild(document.createElement('br'));
							tHeadCell.appendChild(document.createTextNode(parseDateToWords(dateOffset(new Date(), 2))));
							break;
						case 4:
							tHeadCell.appendChild(document.createTextNode(moment(dateOffset(new Date(), 3)).format('dddd')));
							tHeadCell.appendChild(document.createElement('br'));
							tHeadCell.appendChild(document.createTextNode(parseDateToWords(dateOffset(new Date(), 3))));
							break;
						case 5:
							tHeadCell.appendChild(document.createTextNode(moment(dateOffset(new Date(), 4)).format('dddd')));
							tHeadCell.appendChild(document.createElement('br'));
							tHeadCell.appendChild(document.createTextNode(parseDateToWords(dateOffset(new Date(), 4))));
							break;
						case 6:
							tHeadCell.appendChild(document.createTextNode(moment(dateOffset(new Date(), 5)).format('dddd')));
							tHeadCell.appendChild(document.createElement('br'));
							tHeadCell.appendChild(document.createTextNode(parseDateToWords(dateOffset(new Date(), 5))));
							break;
						case 7:
							tHeadCell.appendChild(document.createTextNode(moment(dateOffset(new Date(), 6)).format('dddd')));
							tHeadCell.appendChild(document.createElement('br'));
							tHeadCell.appendChild(document.createTextNode(parseDateToWords(dateOffset(new Date(), 6))));
							break;
					}
				}
				
				debugger;

				for (var i = 0; i < 27; i++) {
						const tableRow = table.insertRow();
					for (var j = 0; j < 8; j++) {
						const tableCell = tableRow.insertCell();
						tableCell.style.width = '30px';
						tableCell.style.height = 'auto';
						tableCell.style.border = '1px solid black';
						tableCell.style.padding = '5px';
						if (j == 0) {
							tableCell.style.textAlign = 'center';
							tableCell.style.fontWeight = 'bold';
							tableCell.append(document.createTextNode(reservationIntervals[i]));
						}
						else {
							debugger;
							var slotList = document.createElement("p");
							$(slotList).addClass('slot-list');

							var slotsTaken = 0;
							var slotsTakenString;

							var time = $(times)[i];
							var date = moment(dateOffset(new Date(), j - 1)).format();
							date = date.substring(0, 10);
							var dateTime = date.concat("T", time);
							var studentList = null;

							var viewSlotsButton = document.createElement('button');
							$(viewSlotsButton).addClass('view-slots-button');
							viewSlotsButton.innerText = "View Slots";

							slotList.innerHTML = "Available: <br>";							
							for (var k = 0; k < 40; k++) {

								if (reservations.length > 0) {
									for (var l = 0; l < reservations.length; l++) {
										var user = reservations[l];

										if (dateTime == user.datetime && labNum == user.lab && k + 1 == user.seat && user.isAnonymous == false) {
											var studentLink = document.createElement('LI');
											studentLink.innerHTML = "<a href='" + user.link + "'> " + user.name + " </a>";
											slotsTaken += 1;
											
											if (studentList == null) 
												studentList = document.createElement('UL');
											
											studentList.appendChild(studentLink);
										}

										else {
											slotList.innerHTML = slotList.innerHTML.concat(k + 1);

											if (k < 39)
												slotList.innerHTML = slotList.innerHTML.concat(", ");
										}
									}
								}

								else {
									slotList.innerHTML = slotList.innerHTML.concat(k + 1);

									if (k < 39)
										slotList.innerHTML = slotList.innerHTML.concat(", ");
								}
							}
							
							slotsTakenString = document.createElement('p');
							slotsTakenString.innerHTML = slotsTaken + " / 40 Slots Taken";
							
							tableCell.append(viewSlotsButton);
							slotList.style.display = 'none';
							tableCell.append(slotList);

							if (studentList != null) {
								var studentHeading = document.createElement('p');
								studentHeading.innerHTML = "<b> Students Reserved </b>";
								tableCell.append(studentHeading);
								tableCell.append(studentList);
							}

							tableCell.append(slotsTakenString);
						}
					}
				}

				return table;
			}	

			function makeList() {

			}

			$(document).ready(function() {
				for (var i = 0; i < 3; i++) {
					var lab;
					switch(i) {
						case 0:
							lab = document.getElementById("lab-1");
							break;
						case 1:
							lab = document.getElementById("lab-2");
							break;
						case 2:
							lab = document.getElementById("lab-3");
							break;
					}

					const labTable = lab.appendChild(createCalendar(i + 1));
					$(labTable).addClass('calendar-table');
					labTable.style.display = "none";
				}

				$("#lab-button-1").click(function() {
					var calendar = document.querySelector('#lab-1 > .calendar-table')
					if (document.getElementById("lab-button-1").innerText == '+')
						document.getElementById("lab-button-1").innerText = '-';
					else
						document.getElementById("lab-button-1").innerText = '+';

					if (calendar.style.display == "none")
						calendar.style.display = "table";
					else
						calendar.style.display = "none";
				})

				$("#lab-button-2").click(function() {
					var calendar = document.querySelector('#lab-2 > .calendar-table')
					if (document.getElementById("lab-button-2").innerText == '+')
						document.getElementById("lab-button-2").innerText = '-';
					else
						document.getElementById("lab-button-2").innerText = '+';

					if (calendar.style.display == "none")
						calendar.style.display = "table";
					else
						calendar.style.display = "none";
				})

				$("#lab-button-3").click(function() {
					var calendar = document.querySelector('#lab-3 > .calendar-table')
					if (document.getElementById("lab-button-3").innerText == '+')
						document.getElementById("lab-button-3").innerText = '-';
					else
						document.getElementById("lab-button-3").innerText = '+';
					
						if (calendar.style.display == "none")
						calendar.style.display = "table";
					else
						calendar.style.display = "none";
				})

				$(".view-slots-button").click(function() {
					var slotList = $(this).parent().children('.slot-list');
					if (slotList.css('display') == 'none') {
						slotList.css('display', 'block');
						$(this).html("Hide Slots");
					}

					else {
						slotList.css('display', 'none');
						$(this).html("View Slots");
					}
				});
			})

			

		</script>

	</head>
	<body>
		<nav class="site_header">
			<span id="site_name"><h1>Lab Reservation System</h1></span>
			<span class="site_nav">
				<span class="user_profile" onclick="location.href='user_profile.html'"> Profile </span>
				<span class="search_slots" onclick="location.href='slot_search.html'"> Search Lab Slots </span>
				<span class="lab_slots" onclick="location.href='slot_availability.html'"> View Lab Slots </span>
				<span class="logout" onclick="location.href='login.html'"> Log Out </span>
			</span>
			
		</nav>

		<div class="container">
			<div class="lab-dropdown" id="lab-1">
				<div class="lab-dropdown-row">
					<h2 style="float: left; font-size: 30px;"> Lab 1 </h2>
					<button class="lab-button button-font" id="lab-button-1"> + </button>
				</div>
			</div>
	
			<div class="lab-dropdown" id="lab-2">
				<div class="lab-dropdown-row">
					<h2 style="float: left; font-size: 30px;"> Lab 2 </h2>
					<button class="lab-button button-font" id="lab-button-2"> + </button>
				</div>
			</div>
	
			<div class="lab-dropdown" id="lab-3">
				<div class="lab-dropdown-row">
					<h2 style="float: left; font-size: 30px;"> Lab 3 </h2>
					<button class="lab-button button-font" id="lab-button-3"> + </button>
				</div>
			</div>
		</div>
	</body>
</html>